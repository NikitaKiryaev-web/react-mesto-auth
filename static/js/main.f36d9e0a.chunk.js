(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{17:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var o=n(1),c=n.n(o),a=n(19),i=n.n(a),s=n(9),r=(n(17),n(24)),u=n(3),l=n(2),p=n(0);var d=function(){return Object(p.jsx)("footer",{className:"footer",children:Object(p.jsx)("p",{className:"footer__copyright",children:"\xa9 2020 Mesto Russia"})})},j=n(20);var h=function(e){var t=Object(o.useState)(""),n=Object(u.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)(""),s=Object(u.a)(i,2),r=s[0],l=s[1];return Object(p.jsxs)("section",{className:"auth",children:[Object(p.jsx)("h1",{className:"auth__title",children:e.title}),Object(p.jsxs)("form",{className:"auth__form",onSubmit:function(t){t.preventDefault(),e.onSubmit(r,c),l(""),a("")},noValidate:!0,children:[Object(p.jsx)("input",Object(j.a)({className:"auth__input",placeholder:"Email",type:"text",minLength:"2",value:c,onChange:function(e){a(e.target.value)},required:!0,name:"email",autoComplete:"off"},"type","email")),Object(p.jsx)("input",{className:"auth__input",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",type:"password",minLength:"2",value:r,onChange:function(e){l(e.target.value)},required:!0,name:"password",autoComplete:"off"}),Object(p.jsx)("button",{className:"auth__submit-button",type:"submit",children:e.buttonText})]}),e.children]})};var b=function(e){return Object(p.jsx)(h,{title:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",buttonText:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",onSubmit:function(t,n){e.handleRegister(t,n)},children:Object(p.jsx)(s.b,{className:"auth__signin-tip",activeClassName:"auth__signin-tip_active",to:"/sign-in",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0412\u043e\u0439\u0442\u0438"})})},f=n.p+"static/media/logo.c2821b38.svg";var m=function(e){return Object(p.jsxs)("header",{className:"header",children:[Object(p.jsx)("img",{src:f,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f",className:"header__logo"}),Object(p.jsxs)("div",{className:"header__wrapper",children:[Object(p.jsx)("p",{className:"header__user-info",children:e.userEmail}),Object(p.jsx)("button",{className:"header__link",type:"button",onClick:function(){e.onHeaderLinkClick(e.link)},children:e.linkText})]})]})},_=c.a.createContext();var O=function(e){var t=Object(o.useContext)(_),n=e.card.owner._id===t._id,c="photos__delete-button ".concat(!n&&"photos__delete-button_inactive"),a=e.card.likes.some((function(e){return e._id===t._id})),i="photos__like-button ".concat(a&&"photos__like-button_active");return Object(p.jsxs)("div",{className:"photos__card",children:[Object(p.jsx)("img",{src:e.card.link,alt:"\u0424\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044f",className:"photos__illustration",onClick:function(){e.onCardClick(e.card)}}),Object(p.jsx)("button",{className:c,type:"button",onClick:function(){e.onCardDelete(e.card)}}),Object(p.jsxs)("div",{className:"photos__wrap",children:[Object(p.jsx)("h2",{className:"photos__title",children:e.card.name}),Object(p.jsxs)("div",{className:"photos__like-wrap",children:[Object(p.jsx)("button",{className:i,type:"button",onClick:function(){e.onCardLike(e.card)}}),Object(p.jsx)("p",{className:"photos__like-counter",children:e.card.likes.length})]})]})]})};var v=function(e){var t=Object(o.useContext)(_);return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("main",{className:"content",children:[Object(p.jsxs)("section",{className:"profile",children:[Object(p.jsxs)("div",{className:"profile__avatar-overlay",children:[Object(p.jsx)("img",{src:t.avatar,alt:"\u0410\u0432\u0430\u0442\u0430\u0440",className:"profile__avatar"}),Object(p.jsx)("div",{className:"profile__button-overlay",children:Object(p.jsx)("button",{type:"button",className:"profile__avatar-button",onClick:e.onEditAvatar})})]}),Object(p.jsxs)("div",{className:"profile__info",children:[Object(p.jsxs)("div",{className:"profile__wrap",children:[Object(p.jsx)("h1",{className:"profile__title",children:t.name}),Object(p.jsx)("button",{className:"profile__edit-button",type:"button",onClick:e.onEditProfile})]}),Object(p.jsx)("p",{className:"profile__subtitle",children:t.about})]}),Object(p.jsx)("button",{className:"profile__add-button",type:"button",onClick:e.onAddPlace})]}),Object(p.jsx)("section",{className:"photos",children:e.cards.map((function(t){return Object(p.jsx)(O,{card:t,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete},t._id)}))})]})})};var g=function(e){return Object(p.jsx)(h,{title:"\u0412\u0445\u043e\u0434",buttonText:"\u0412\u043e\u0439\u0442\u0438",onSubmit:function(t,n){e.handleLogin(t,n)}})},x=n.p+"static/media/SuccessLog.1b6082f8.svg",C=n.p+"static/media/FailedLog.df8eddf6.svg";var k=function(e){var t=e.isLog?x:C,n=e.isLog?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.",c=function(t){"Escape"===t.key&&e.onClose()};Object(o.useEffect)((function(){return document.addEventListener("keydown",c),function(){document.removeEventListener("keydown",c)}}),[]);var a=function(t){t.target.classList.contains("popup")&&e.onClose()};return Object(o.useEffect)((function(){return document.addEventListener("mousedown",a),function(){document.removeEventListener("mousedown",a)}})),Object(p.jsx)("div",{className:"popup popup_tooltip ".concat(e.isOpen&&"popup_opened"),children:Object(p.jsxs)("div",{className:"popup__container popup__container_tooltip",children:[Object(p.jsx)("button",{className:"popup__close popup__close_tooltip",onClick:e.onClose}),Object(p.jsx)("img",{src:t,className:"popup__tooltip-image"}),Object(p.jsx)("p",{className:"popup__title popup__title_tooltip",children:n})]})})};var N=function(e){var t=function(t){"Escape"===t.key&&e.onClose()};Object(o.useEffect)((function(){return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}),[e.isOpen]);var n=function(t){t.target.classList.contains("popup")&&e.onClose()};return Object(o.useEffect)((function(){return document.addEventListener("mousedown",n),function(){document.removeEventListener("mousedown",n)}}),[e.isOpen]),Object(p.jsx)("div",{className:"popup popup_".concat(e.name," ").concat(!!e.isOpen&&"popup_opened"),children:Object(p.jsxs)("div",{className:"popup__container popup__container_image",children:[Object(p.jsx)("button",{className:"popup__close popup__close_image",onClick:e.onClose}),Object(p.jsx)("img",{src:e.card.link,alt:"\u0424\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044f",className:"popup__illustration"}),Object(p.jsx)("p",{className:"popup__description",children:e.card.name})]})})};var y=function(e){var t=function(t){"Escape"===t.key&&e.onClose()};Object(o.useEffect)((function(){return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}),[]);var n=function(t){t.target.classList.contains("popup")&&e.onClose()};return Object(o.useEffect)((function(){return document.addEventListener("mousedown",n),function(){document.removeEventListener("mousedown",n)}})),Object(p.jsx)("div",{className:"popup popup_".concat(e.name," ").concat(!!e.isOpen&&"popup_opened"),children:Object(p.jsxs)("div",{className:"popup__container popup__container_".concat(e.name),children:[Object(p.jsx)("button",{className:"popup__close popup__close_".concat(e.name),type:"button",onClick:e.onClose}),Object(p.jsx)("h2",{className:"popup__title popup__title_".concat(e.name),children:e.title}),Object(p.jsxs)("form",{className:"popup__form popup__form_".concat(e.name),name:e.name,method:"GET",onSubmit:e.onSubmit,noValidate:!0,children:[e.children,Object(p.jsx)("button",{className:"popup__save-button popup__save-button_".concat(e.name),type:"submit",children:e.buttonText})]})]})})};var E=function(e){var t=Object(o.useContext)(_);Object(o.useEffect)((function(){i(t.name),d(t.about)}),[t,e.isOpen]);var n=Object(o.useState)(),c=Object(u.a)(n,2),a=c[0],i=c[1],s=Object(o.useState)(),r=Object(u.a)(s,2),l=r[0],d=r[1];return Object(p.jsx)(y,{name:"profile",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",isOpen:e.isOpen,onClose:e.onClose,buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:a,profession:l})},children:Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("input",{type:"text",id:"name",minLength:"2",maxLength:"40",value:a||"",onChange:function(e){i(e.target.value)},required:!0,name:"name",autoComplete:"off",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0438\u043c\u044f",className:"popup__input popup__input_type_name"}),Object(p.jsx)("span",{id:"name-error",className:"popup__error"}),Object(p.jsx)("input",{type:"text",id:"profession",minLength:"2",maxLength:"200",value:l||"",onChange:function(e){d(e.target.value)},required:!0,name:"profession",autoComplete:"off",placeholder:"\u0427\u0435\u043c \u0432\u044b \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442\u0435\u0441\u044c?",className:"popup__input popup__input_type_profession"}),Object(p.jsx)("span",{id:"profession-error",className:"popup__error"})]})})};var L=function(e){var t=Object(o.useRef)();return Object(p.jsx)(y,{name:"avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",isOpen:e.isOpen,onClose:e.onClose,buttonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t.current.value})},children:Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("input",{ref:t,type:"url",id:"avatar-url",required:!0,name:"avatar",autoComplete:"off",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440",className:"popup__input popup__input_type_url"}),Object(p.jsx)("span",{id:"avatar-url-error",className:"popup__error"})]})})};var S=function(e){var t=Object(o.useState)(""),n=Object(u.a)(t,2),c=n[0],a=n[1],i=Object(o.useState)(""),s=Object(u.a)(i,2),r=s[0],l=s[1];return Object(p.jsx)(y,{name:"card",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:c,link:r})},buttonText:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",children:Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("input",{type:"text",id:"title",minLength:"2",maxLength:"30",value:c,required:!0,name:"name",onChange:function(e){a(e.target.value)},autoComplete:"off",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",className:"popup__input popup__input_type_title"}),Object(p.jsx)("span",{id:"title-error",className:"popup__error"}),Object(p.jsx)("input",{type:"url",id:"url",value:r,required:!0,name:"link",onChange:function(e){l(e.target.value)},autoComplete:"off",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",className:"popup__input popup__input_type_url"}),Object(p.jsx)("span",{id:"url-error",className:"popup__error"})]})})};var T=function(e){return Object(p.jsx)(l.b,{children:e.isLoggedIn?e.children:Object(p.jsx)(l.a,{to:"/sign-in"})})},w=n(22),P=n(23),A=new(function(){function e(t){Object(w.a)(this,e),this._url=t.url,this._token=t.token}return Object(P.a)(e,[{key:"_getOriginalResponse",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status," ").concat(e.statusText))}},{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._url,"/cards"),{headers:{authorization:this._token}}).then((function(t){return e._getOriginalResponse(t)}))}},{key:"getProfileInfo",value:function(){var e=this;return fetch("".concat(this._url,"/users/me"),{method:"GET",headers:{authorization:this._token}}).then((function(t){return e._getOriginalResponse(t)}))}},{key:"addCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t._getOriginalResponse(e)}))}},{key:"editProfile",value:function(e){var t=this;return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.profession})}).then((function(e){return t._getOriginalResponse(e)}))}},{key:"editProfileAvatar",value:function(e){var t=this;return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.avatar})}).then((function(e){return t._getOriginalResponse(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then((function(e){return t._getOriginalResponse(e)}))}},{key:"likeCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:this._token,"Content-Type":"application/json"}}).then((function(e){return t._getOriginalResponse(e)}))}},{key:"unlikeCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then((function(e){return t._getOriginalResponse(e)}))}}]),e}())({url:"https://mesto.nomoreparties.co/v1/cohort-19",token:"cdc2b984-82a4-4b35-acbd-93038325fc29"}),R="https://auth.nomoreparties.co";var I=function(){var e=Object(o.useState)(!1),t=Object(u.a)(e,2),n=t[0],c=t[1],a=Object(o.useState)(!1),i=Object(u.a)(a,2),s=i[0],j=i[1],h=Object(o.useState)(!1),f=Object(u.a)(h,2),O=f[0],x=f[1],C=Object(o.useState)(!1),y=Object(u.a)(C,2),w=y[0],P=y[1],I=Object(o.useState)(!1),D=Object(u.a)(I,2),z=D[0],F=D[1],q=Object(o.useState)(!1),J=Object(u.a)(q,2),U=J[0],H=J[1],B=Object(o.useState)({}),G=Object(u.a)(B,2),M=G[0],V=G[1],K=Object(o.useState)({}),Q=Object(u.a)(K,2),W=Q[0],X=Q[1],Y=Object(o.useState)([]),Z=Object(u.a)(Y,2),$=Z[0],ee=Z[1],te=Object(o.useState)(!1),ne=Object(u.a)(te,2),oe=ne[0],ce=ne[1],ae=Object(o.useState)(),ie=Object(u.a)(ae,2),se=ie[0],re=ie[1],ue=Object(l.g)();function le(){c(!1),j(!1),x(!1),P(!1),V({}),F(!1)}function pe(e){"/sign-out"===e?(localStorage.removeItem("jwt"),ue.push("/sign-in")):ue.push("".concat(e))}return Object(o.useEffect)((function(){A.getProfileInfo().then((function(e){X(e)})).catch((function(e){console.log("Error: ".concat(e))}))}),[]),Object(o.useEffect)((function(){A.getInitialCards().then((function(e){ee(e)})).catch((function(e){console.log("Error: ".concat(e))}))}),[]),Object(o.useEffect)((function(){localStorage.getItem("jwt")&&function(e){return fetch("".concat(R,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))}(localStorage.getItem("jwt")).then((function(e){ce(!0),re(e.data.email),ue.push("/")})).catch((function(e){return console.log(e)}))}),[ue]),Object(p.jsx)("div",{className:"page",children:Object(p.jsx)("div",{className:"page__container",children:Object(p.jsxs)(_.Provider,{value:W,children:[Object(p.jsxs)(l.d,{children:[Object(p.jsxs)(l.b,{path:"/sign-up",children:[Object(p.jsx)(m,{link:"/sign-in",linkText:"\u0412\u043e\u0439\u0442\u0438",onHeaderLinkClick:pe}),Object(p.jsx)(b,{handleRegister:function(e,t){(function(e,t){return fetch("".concat(R,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))})(e,t).then((function(e){H(!0),F(!0)})).catch((function(e){H(!1),F(!0),console.log(e)}))}})]}),Object(p.jsxs)(l.b,{path:"/sign-in",children:[Object(p.jsx)(m,{link:"/sign-up",linkText:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f",onHeaderLinkClick:pe}),Object(p.jsx)(g,{handleLogin:function(e,t){(function(e,t){return fetch("".concat(R,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}))})(e,t).then((function(e){localStorage.setItem("jwt",e.token),ce(!0),re(t),ue.push("/")})).catch((function(e){return console.log(e)}))}})]}),Object(p.jsxs)(T,{exact:!0,path:"/",isLoggedIn:oe,children:[Object(p.jsx)(m,{userEmail:se,linkText:"\u0412\u044b\u0439\u0442\u0438",link:"/sign-out",onHeaderLinkClick:pe}),Object(p.jsx)(v,{onEditProfile:function(){c(!0)},onAddPlace:function(){j(!0)},onEditAvatar:function(){x(!0)},onCardClick:function(e){V(e),P(!0)},cards:$,onCardLike:function(e){(e.likes.some((function(e){return e._id===W._id}))?A.unlikeCard(e._id):A.likeCard(e._id)).then((function(e){var t=$.map((function(t){return t._id===e._id?e:t}));ee(t)})).catch((function(e){return console.log("Error: ".concat(e))}))},onCardDelete:function(e){A.deleteCard(e._id).then((function(t){var n=$.filter((function(t){return t._id!==e._id}));ee(n)})).catch((function(e){return console.log("Error: ".concat(e))}))}}),Object(p.jsx)(d,{})]}),Object(p.jsx)(l.b,{children:oe?Object(p.jsx)(l.a,{to:"/"}):Object(p.jsx)(l.a,{to:"/sign-in"})})]}),Object(p.jsx)(E,{isOpen:n,onClose:le,onUpdateUser:function(e){A.editProfile(e).then((function(e){X(e),le()})).catch((function(e){return console.log("Error: ".concat(e))}))}}),Object(p.jsx)(S,{isOpen:s,onClose:le,onAddPlace:function(e){A.addCard(e).then((function(e){ee([e].concat(Object(r.a)($))),le()})).catch((function(e){return console.log("Error: ".concat(e))}))}}),Object(p.jsx)(L,{isOpen:O,onClose:le,onUpdateAvatar:function(e){A.editProfileAvatar(e).then((function(e){X(e),le()})).catch((function(e){return console.log("Error: ".concat(e))}))}}),Object(p.jsx)(N,{name:"image",isOpen:w,onClose:le,card:M}),Object(p.jsx)(k,{isOpen:z,isLog:U,onClose:function(){F(!1),U&&ue.push("/sign-in")}})]})})})},D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,36)).then((function(t){var n=t.getCLS,o=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),o(e),c(e),a(e),i(e)}))};i.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(s.a,{children:Object(p.jsx)(I,{})})}),document.getElementById("root")),D()}},[[35,1,2]]]);
//# sourceMappingURL=main.f36d9e0a.chunk.js.map